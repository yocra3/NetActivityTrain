# yocra3/NetActivityTrain: Output

## Introduction

This document describes the output produced by the pipeline. The directories listed below will be created in the results directory after the pipeline has finished. The pipeline generates the folder `Dataset/Parameters/` in the top-level results directory, where Dataset and Parameters correspond to `data_name` and  `params_name` arguments. All paths below refer to the folder `results/Dataset/Parameters/`, where results is top-level results directory. 

## Pipeline overview

The pipeline is built using [Nextflow](https://www.nextflow.io/). The pipeline to train a sparsely-connected autoencoder processes data using the following steps:

- Data preprocessing: Prepare the gene expression data for training
- Model training: Train the sparsely-connected autoencoder
- Model post-process: Process the trained model for downstream analysis. 

### Data pre-processing

The pipeline standardize the gene expression measurements at gene level and splits the datasets into training and test. 

<details markdown="1">
<summary>Output files</summary>

- `model_training/`
  - `test_genes.txt`: txt file with the names of the input genes of the gene expression dataset. **For re-using the model, the genes should be in this order.**
  - `*_test_indices.csv`: csv file with the indices of the samples in the test subset. The indices are 0-based.
  - `*_pathways_names.csv`: csv file with names of the gene sets in the model. **When re-using the model, the gene sets will be generated in this order.**
</details>

### Model training

<details markdown="1">
<summary>Output files</summary>

- `model_training/`
  - `*_history_model.pb`: pickle file with the results of the training. 
  - `*_training_evaluation.txt`: txt file with the training loss for each step.
  - `data_name/`: directory with the model trained. This directory will be named using `data_name` argument.

</details>

### Model post-process

This step prepares the data for [NetActivity](https://bioconductor.org/packages/release/bioc/html/NetActivity.html). The pipeline only outputs the weights of the first layer, so it can only be used one the first layer represents the gene set activity scores.

<details markdown="1">
<summary>Output files</summary>

- `NetActivity_weights/`
  - `*_NetActivity_weights.Rdata`: Rdata file to be used in `NetActivity`.
  - `*_model_weights.h5`: h5 file with the model weights. 
 
</details>



### Pipeline information

<details markdown="1">
<summary>Output files</summary>

- `pipeline_info/`
  - Reports generated by Nextflow: `execution_report.html`, `execution_timeline.html`, `execution_trace.txt` and `pipeline_dag.dot`/`pipeline_dag.svg`.
  - Reports generated by the pipeline: `pipeline_report.html`, `pipeline_report.txt` and `software_versions.yml`. The `pipeline_report*` files will only be present if the `--email` / `--email_on_fail` parameter's are used when running the pipeline.

</details>

[Nextflow](https://www.nextflow.io/docs/latest/tracing.html) provides excellent functionality for generating various reports relevant to the running and execution of the pipeline. This will allow you to troubleshoot errors with the running of the pipeline, and also provide you with other information such as launch commands, run times and resource usage.
